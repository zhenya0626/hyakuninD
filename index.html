<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>百人一首対戦</title>
	<link rel="stylesheet" type="text/css" href="common/css/style.css">
	
	<!-- <style type="text/css">
		ul{
			list-style: none;
		}
	</style> -->
</head>
<body>

	<div class="clearFix" id ="info">
		<div id="point1">あなたの得点:0  </div>
		<div id="point2">相手の得点:0  </div>
	</div>
	<div id="ques"></div>
	<div  class="clearFix" id="ans"></div>



	<form id ="myForm">
		<select id="rooms">
			<option value="room-1">Room1</option>
			<option value="room-2">Room2</option>
		</select>
		<input type="text" id="name"><input type="text" id="msg"><input type="submit" value="Send!">
	</form>
	<div id="room"></div>
	<ul id="logs"></ul>
	<!-- <div id = "news"></div> -->

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="/socket.io/socket.io.js"></script>

	<script>
		$(function(){
			var quesSet = []; 
			var quesOrder = []; 

			var kimariji = ["あきの","はるす","あし","たご","おく","かさ","あまの","わがい","はなの","これ","わたのはらや","あまつ","つく","みちの","きみがためは","たち","ちは","す","なにはが","わび","いまこ","ふ","つき","この","なにし","をぐ","みかの","やまざ","こころあ","ありあ","あさぼらけあ","やまが","ひさ","たれ","ひとは","なつ","しら","わすら","あさぢ","しの","こひ","ちぎりき","あひ","あふ","あはれ","ゆら","やへ","かぜを","みかき","きみがためを","かく","あけ","なげき","わすれ","たき","あらざ","め","ありま","やす","おほえ","いに","よを","いまは","あさぼらけう","うら","もろ","はるの","こころに","あらし","さ","ゆふ","おと","たか","うか","ちぎりお","わたのはらこ","せ","あはぢ","あきか","ながか","ほ","おも","よのなかよ","ながら","よも","なげけ","む","なにはえ","たま","みせ","きり","わがそ","よのなかは","みよ","おほけ","はなさ","こぬ","かぜそ","ひとも","もも"]

			
			// var news = io.connect('http://localhost:1337/news');


			$("img").click(function(){
				if($(this).hasClass('on')) {
					var id = $(this).attr("id");
					if(String(quesOrder[qNum]) === id){
						// TO DO サーバーサイドで勝敗判定
						
						// した後-------------------------------------------------ここから
						point1 ++;
						qNum ++;
						$('#point1').text('あなたの得点:'+point1+'点  ');
						$('#point2').text('相手の得点:'+point2+'点  ');
						$(this).css("opacity","0");
						$(this).removeClass('on');
						
						$('#ques').empty();
						$('#ques').append('<div>'+(qNum+1)+'.'+kimariji[quesOrder[qNum]-1]+'</div>');

						// した後-------------------------------------------------ここまで
					}else{
						// TO DO お手つき
						// した後-------------------------------------------------ここから
						point2 ++;
						// qNum ++;
						$('#point1').text('あなたの得点:'+point1+'点  ');
						$('#point2').text('相手の得点:'+point2+'点  ');
						// $(this).css("opacity","0");
						// $(this).removeClass('on');
						
						$('#ques').empty();
						$('#ques').append('<div>'+(qNum+1)+'.'+kimariji[quesOrder[qNum]-1]+'</div>');

						// した後-------------------------------------------------ここまで
					}
				}
				
			})


			
			$('#myForm').submit(function(e){
			// 	e.preventDefault();
				ques.json.emit('quesSet',{
					msg: $('#msg').val(),
					name: $('#name').val(),
					room: $('#rooms').val()
				});
			// 	$('#msg').val('').focus();
			});
			var ques = io.connect('http://localhost:1337/ques');
			ques.on('quesSet',function(data){
				alert('quesSet: '+data.quesSet+'  quesOrder: '+data.quesOrder+'quesSet[5]: '+data.quesSet[5]);
				quesSet = data.quesSet;
				quesOrder = data.quesOrder;

				alert(quesSet[5]);
				var point1 = 0;
				var point2 = 0;
				var qNum = 0 ;
				$('#ques').append('<div>第'+(qNum+1)+'問　'+kimariji[quesOrder[qNum]-1]+'</div>');
				for(var i = 1 ; i <= 30;i++){
				// $('#ques').append('<div style="float:left;">'+i+'.'+kimariji[quesOrder[i-1]-1]+'</div>');
				// $('#ans').append('<div>'+kimariji[quesSet[i-1]-1]+'</div>');
				$('#ans').append('<img style="float:left;" class="on" id="'+quesSet[i-1]+'"src="common/img/'+quesSet[i-1]+'.png">');
				}

			});
			// ques.on('room',function(data){
			// 	$('#room').text('Room : '+ data.room);
			// });


			var chat = io.connect('http://localhost:1337/chat');
			// var news = io.connect('http://localhost:1337/news');
			$('#myForm').submit(function(e){
				e.preventDefault();
				chat.json.emit('emit_from_client',{
					msg: $('#msg').val(),
					name: $('#name').val(),
					room: $('#rooms').val()
				});
				$('#msg').val('').focus();
			});
			
			chat.on('emit_from_server',function(data){
				console.log(data);
				$('#logs').append($('<li>').text(data));
			});
			chat.on('room',function(data){
				$('#room').text('Room : '+ data.room);
			});
			// news.on('emit_from_server',function(data){
			// 	$('#news').text(data);
			// });
		});
	</script>
	
</body>
</html>