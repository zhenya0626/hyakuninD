<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>百人一首対戦</title>
	<link rel="stylesheet" type="text/css" href="common/css/style.css">

</head>
<body>

	<div class="clearFix" id ="info">
		<div id="point1">あなたの得点:0  </div>
		<div id="point2">相手の得点:0  </div>
	</div>
	<div id="ques"></div>
	<div  class="clearFix" id="ans"></div>



	<form id ="myForm">
		<select id="rooms">
			<option value="room-1">Room1</option>
			<option value="room-2">Room2</option>
		</select>
		<input type="text" id="name"><input type="text" id="msg"><input type="submit" value="Send!">
	</form>
	<div id="room"></div>
	<ul id="logs"></ul>


	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="/socket.io/socket.io.js"></script>

	<script>
		var quesSet = []; 
		var quesOrder = []; 
		var point1 = 0;
		var point2 = 0;
		var qNum = 0 ;
		var kimariji = ["あきの","はるす","あし","たご","おく","かさ","あまの","わがい","はなの","これ","わたのはらや","あまつ","つく","みちの","きみがためは","たち","ちは","す","なにはが","わび","いまこ","ふ","つき","この","なにし","をぐ","みかの","やまざ","こころあ","ありあ","あさぼらけあ","やまが","ひさ","たれ","ひとは","なつ","しら","わすら","あさぢ","しの","こひ","ちぎりき","あひ","あふ","あはれ","ゆら","やへ","かぜを","みかき","きみがためを","かく","あけ","なげき","わすれ","たき","あらざ","め","ありま","やす","おほえ","いに","よを","いまは","あさぼらけう","うら","もろ","はるの","こころに","あらし","さ","ゆふ","おと","たか","うか","ちぎりお","わたのはらこ","せ","あはぢ","あきか","ながか","ほ","おも","よのなかよ","ながら","よも","なげけ","む","なにはえ","たま","みせ","きり","わがそ","よのなかは","みよ","おほけ","はなさ","こぬ","かぜそ","ひとも","もも"]

		$(function(){
			$('#myForm').submit(function(e){
				ques.json.emit('quesSet',{
					msg: $('#msg').val(),
					name: $('#name').val(),
					room: $('#rooms').val()
				});
			});
			var ques = io.connect('http://localhost:1337/ques');
			ques.on('quesSet',function(data){
				alert('quesSet: '+data.quesSet+'  quesOrder: '+data.quesOrder+'quesSet[5]: '+data.quesSet[5]);
				quesSet = data.quesSet;
				quesOrder = data.quesOrder;

				$('#ques').append('<div>第'+(qNum+1)+'問　'+kimariji[quesOrder[qNum]-1]+'</div>');
				for(var i = 1 ; i <= 30;i++){

				$('#ans').append('<img style="float:left;" class="on" id="'+quesSet[i-1]+'"src="common/img/'+quesSet[i-1]+'.png">');
				}
			});

			var chat = io.connect('http://localhost:1337/chat');
			// var news = io.connect('http://localhost:1337/news');
			$('#myForm').submit(function(e){
				e.preventDefault();
				chat.json.emit('emit_from_client',{
					msg: $('#msg').val(),
					name: $('#name').val(),
					room: $('#rooms').val()
				});
				$('#msg').val('').focus();
			});
			
			chat.on('emit_from_server',function(data){
				// console.log(data);
				$('#logs').append($('<li>').text(data));
			});
			chat.on('room',function(data){
				$('#room').text('Room : '+ data.room);
			});
		});

		var judge = io.connect('http://localhost:1337/judge');


		var bool;
		judge.on('judge',function(data){
			
			// alert('hasha');
			qNum = data.qNum;
			point1 = data.point1;
			point2 = data.point2;
			bool = data.bool;
			var id = data.id;

			// alert('p1: '+point1+'  p2: '+point2+'  qNum: '+qNum+'  bool: '+bool);
			$('#point1').text('あなたの得点:'+point1+'点  ');
			$('#point2').text('相手の得点:'+point2+'点  ');
			if(bool){
				// alert(bool);
				$('#'+id+'').css("opacity","0");
				$('#'+id+'').removeClass('on');						
				$('#ques').empty();
				$('#ques').append('<div>第'+(qNum+1)+'問  '+kimariji[quesOrder[qNum]-1]+'</div>');
			}
		});

		$(document).on('click','img', function(){
				// var clickedImage = $(this);
				
				if($(this).hasClass('on')) {
					var id = $(this).attr("id");
					//OK alert('haha');
					
					// TO DO サーバーサイドでid判定
					//id qNumを送信
					

					judge.json.emit('judge',{
						qNum: qNum,
						id: id
						// name: $('#name').val()
					});


				}
				
			});
	</script>
	
</body>
</html>